id: app.katvan.Katvan
runtime: org.kde.Platform
runtime-version: '6.8'
sdk: org.kde.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
command: katvan
rename-desktop-file: katvan.desktop
rename-icon: katvan
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --share=network
  - --filesystem=xdg-data/typst/packages:ro
build-options:
  append-path: /usr/lib/sdk/rust-stable/bin

modules:
  - name: corrosion
    buildsystem: cmake-ninja
    builddir: true
    cleanup:
      - '*'
    sources:
      - type: git
        url: https://github.com/corrosion-rs/corrosion.git
        commit: b1fab721655c5c4b1b08a083d3cd29f163af75d0
        tag: v0.5.1
  
  - name: cxxbridge
    buildsystem: simple
    build-commands:
      - cargo install --root ${FLATPAK_DEST} --path .
    build-options:
      env:
        CARGO_HOME: /run/build/cxxbridge/cargo
    cleanup:
      - '*'
    sources:
      - type: archive
        archive-type: tar-gzip
        url: https://crates.io/api/v1/crates/cxxbridge-cmd/1.0.124/download
        sha256: de30fc7f8b99c54cfd811c581e5af6423a4c45d4774fb5f2534aefa2f345f634
      - 'cxxbridge-generated-sources.json'

  - name: python3-mistletoe
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --prefix=${FLATPAK_DEST} mistletoe-1.4.0-py3-none-any.whl
    cleanup:
      - '*'
    sources:
      - type: file
        url: https://github.com/miyuchina/mistletoe/releases/download/v1.4.0/mistletoe-1.4.0-py3-none-any.whl
        sha256: 44a477803861de1237ba22e375c6b617690a31d2902b47279d1f8f7ed498a794

  - name: katvan
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DKATVAN_FLATPAK_BUILD=ON
      - -DKATVAN_CARGO_PROFILE=release
    build-options:
      env:
        CARGO_HOME: /run/build/katvan/cargo
    sources:
      - type: git
        url: https://github.com/IgKh/katvan.git
        commit: a0da313258adbe04bff9daf38d9e41d36480b2f3
        tag: v0.10.0
      - 'katvan-generated-sources.json'
